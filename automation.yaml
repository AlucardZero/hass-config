- alias: 'Away Mode'
  trigger:
    platform: state
    entity_id: group.all_devices
    state: 'not_home'
    for:
      hours: 0
      minutes: 10
      seconds: 1
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: script.away

- alias: 'Update Available Notifications'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.notify
    data:
      message: 'Update for Home Assistant is available.'

- alias: 'Set heat when I get home'
  trigger:
    platform: state
    entity_id: group.all_devices
    from: 'not_home'
    to: 'home'
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.stelpro_stzw402_electronic_thermostat_temperature_11
        below: 60
      - condition: state
        entity_id: input_boolean.vacation
        state: 'off'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: script.heat_occupied

- alias: 'Set heat lower after bed'
  trigger:
    platform: state
    entity_id: group.bedroom_lights
    from: 'on'
    to: 'off'
  condition:
    condition: and
    conditions:
      - condition: time
        after: "22:00:00"
        before: "05:00:00"
      - condition: numeric_state
        entity_id: sensor.stelpro_stzw402_electronic_thermostat_temperature_11
        below: 60
      - condition: state
        entity_id: group.all_devices
        state: 'home'
      - condition: state
        entity_id: input_boolean.vacation
        state: 'off'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: script.heat_bed

- alias: 'Set heat higher in the morning'
  trigger:
    platform: time
    after: "08:00"
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.all_devices
        state: 'home'
      - condition: numeric_state
        entity_id: sensor.stelpro_stzw402_electronic_thermostat_temperature_11
        below: 60
      - condition: state
        entity_id: input_boolean.vacation
        state: 'off'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: script.heat_occupied

- alias: 'Turn on light when I get home after sunset'
  trigger:
    platform: state
    entity_id: group.all_devices
    from: 'not_home'
    to: 'home'
  condition:
    condition: and
    conditions:
      - condition: sun
        after: sunset
        after_offset: "-0:55:00"
      - condition: state
        entity_id: group.bedroom_lights
        state: 'off'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: homeassistant.turn_on
    entity_id: "script.get_home_sunset"

- alias: 'Turn on light near sunset when home'
  trigger:
    platform: sun
    event: sunset
    offset: "-00:55:00"
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.bedroom_lights
        state: 'off'
      - condition: state
        entity_id: !secret device_tracker_1
        state: 'home'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: homeassistant.turn_on
    entity_id: group.bedroom_lights

- alias: 'Notify about traffic'
  trigger:
    platform: numeric_state
    entity_id: sensor.to_work_in
    above: 15
  condition: 
    condition: and
    conditions:
      - condition: time
        after: "08:15"
        before: "09:15"
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: state
        entity_id: group.all_devices
        state: 'home'
      - condition: state
        entity_id: input_boolean.vacation
        state: 'off'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    - service: notify.email
      data:
        message: "Commute is {{ states.sensor.to_work_in.attributes.duration_in_traffic }}."
        title: "Seek alternate route to work"

- alias: "Show near-term weather forecast"
  trigger:
    platform: state
    entity_id: sensor.pws_tf_period_0_text
  action:
      service: persistent_notification.create
      data:
        title: "Upcoming Weather"
        message: "{{ states.sensor.pws_tf_period_0_text.state }}"
        notification_id: 2

- alias: 'Vacation - Turn on lights at sunset'
  trigger:
    platform: sun
    event: sunset
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.vacation
        state: 'on'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
      service: homeassistant.turn_on
      entity_id: group.bedroom_lights

- alias: 'Vacation - Turn off lights at 2200'
  trigger:
    platform: time
    after: '22:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.vacation
        state: 'on'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
      service: homeassistant.turn_off
      entity_id: group.all_lights
