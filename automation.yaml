- alias: Away Mode
  trigger:
    platform: state
    entity_id: group.all_devices
    state: 'not_home'
    for:
      hours: 0
      minutes: 10
      seconds: 1
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: script.away

- alias: 'Update Available Notifications'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.notify
    data:
      message: 'Update for Home Assistant is available.'

- alias: 'Turn on light when I get home after sunset'
  trigger:
    platform: state
    entity_id: group.all_devices
    from: 'not_home'
    to: 'home'
  condition:
    condition: and
    conditions:
      - condition: sun
        after: sunset
        after_offset: "-0:45:00"
      - condition: state
        entity_id: group.bedroom_lights
        state: 'off'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    service: homeassistant.turn_on
    entity_id: "script.get_home"

- alias: 'Notify about traffic'
  trigger:
    platform: numeric_state
    entity_id: sensor.to_work_in
    above: 15
  condition: 
    condition: and
    conditions:
      - condition: time
        after: "08:15"
        before: "09:15"
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: state
        entity_id: group.all_devices
        state: home
      - condition: state
        entity_id: input_boolean.vacation
        state: 'off'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
    - service: notify.email
      data:
        message: "Commute is {{ states.sensor.to_work_in.attributes.duration_in_traffic }}."
        title: "Seek alternate route to work"

- alias: 'Vacation - Turn on lights at sunset'
  trigger:
    platform: sun
    event: sunset
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.vacation
        state: 'on'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
      service: homeassistant.turn_on
      entity_id: group.bedroom_lights

- alias: 'Vacation - Turn off lights at 2200'
  trigger:
    platform: time
    after: '22:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.vacation
        state: 'on'
      - condition: state
        entity_id: input_boolean.automation_override
        state: 'off'
  action:
      service: homeassistant.turn_off
      entity_id: group.bedroom_lights
